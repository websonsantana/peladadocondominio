<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Trabalho</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
            color: #444;
        }
        .button-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .button-container select, .button-container button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        .button-container select {
            background-color: #0056b3;
        }
        .button-container select:hover {
            background-color: #004080;
        }
        .button-container button:hover {
            background-color: #0056b3;
        }
        .table-wrapper {
            display: flex;
            justify-content: space-between;
        }
        .table-container {
            flex: 1;
            margin: 0 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .folga {
            background-color: red;
            color: white;
        }
        .ana {
            background-color: #d0e6ff;
        }
        .sibele {
            background-color: #e6f0d0;
        }
        .total {
            font-weight: bold;
        }
        textarea {
            width: 100%;
            height: 50px;
            margin-top: 5px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Escala de Trabalho</h1>

        <div class="button-container">
            <select id="monthSelector" onchange="showMonth(this.value)">
                <option value="08">Agosto</option>
                <option value="09">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
            </select>
            <button onclick="prevWeek()">Semana Anterior</button>
            <button onclick="nextWeek()">Próxima Semana</button>
        </div>

        <div class="table-wrapper">
            <div class="table-container">
                <h2>Ana</h2>
                <table id="anaSchedule">
                    <thead>
                        <tr>
                            <th>Dia</th>
                            <th>Dia da Semana</th>
                            <th>Turno</th>
                            <th>Total de Horas</th>
                            <th>Anotação</th>
                        </tr>
                    </thead>
                    <tbody id="anaScheduleBody">
                        <!-- A tabela será preenchida dinamicamente -->
                    </tbody>
                </table>
            </div>

            <div class="table-container">
                <h2>Sibele</h2>
                <table id="sibeleSchedule">
                    <thead>
                        <tr>
                            <th>Dia</th>
                            <th>Dia da Semana</th>
                            <th>Turno</th>
                            <th>Total de Horas</th>
                            <th>Anotação</th>
                        </tr>
                    </thead>
                    <tbody id="sibeleScheduleBody">
                        <!-- A tabela será preenchida dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const hoursPerDay = {
            "Ana": { start: 9, end: 17.33, break: 1 }, // 09:00 às 17:20
            "Sibele": { start: 13.67, end: 22, break: 1 } // 13:40 às 22:00
        };

        const sundayShiftAna = "09h00 às 17h20";
        const sundayShiftSibele = "11h40 às 20h00";
        const defaultShiftAna = "09h00 às 17h20";
        const defaultShiftSibele = "13h40 às 22h00";
        const shiftAnaWhenSibeleOff = "13h00 às 22h00";

        let currentMonth = '08';
        let currentWeekStart = getFirstMondayOfMonth(currentMonth);

        function getFirstMondayOfMonth(month) {
            const date = new Date(`2024-${month}-01`);
            const dayOfWeek = date.getDay();
            const daysToMonday = (dayOfWeek === 0 ? 6 : dayOfWeek - 1);
            date.setDate(date.getDate() - daysToMonday);
            return date;
        }

        function generateSchedule(month, startOfWeek) {
            const schedule = [];
            const daysInMonth = new Date(2024, parseInt(month, 10), 0).getDate();
            let dayOfMonth = 1;
            const daysOffAna = new Set();
            const daysOffSibele = new Set();
            let anaDaysOffCount = 0;
            let sibeleDaysOffCount = 0;

            for (let i = 0; i < 7 * 6; i++) { // 6 semanas
                const date = new Date(startOfWeek);
                date.setDate(date.getDate() + i);

                if (date.getMonth() + 1 !== parseInt(month, 10)) {
                    continue;
                }

                const day = date.getDate();
                const dayOfWeek = date.toLocaleDateString('pt-BR', { weekday: 'long' });

                let anaShift = defaultShiftAna;
                let sibeleShift = defaultShiftSibele;
                let anaHours = calculateHours(9, 17.33);
                let sibeleHours = calculateHours(13.67, 22);
                let classAna = '';
                let classSibele = '';

                if (dayOfWeek === "domingo") {
                    if (anaDaysOffCount === 0 && !daysOffAna.has(day)) {
                        anaShift = sundayShiftAna;
                        anaHours = calculateHours(9, 17.33);
                        classAna = 'folga';
                        daysOffAna.add(day);
                        anaDaysOffCount++;
                    }

                    if (sibeleDaysOffCount === 0 && !daysOffSibele.has(day)) {
                        sibeleShift = sundayShiftSibele;
                        sibeleHours = calculateHours(11.67, 20);
                        classSibele = 'folga';
                        daysOffSibele.add(day);
                        sibeleDaysOffCount++;
                    }
                } else {
                    if (!daysOffAna.has(day) && Math.random() < 0.2 && anaDaysOffCount < 3) {
                        anaShift = "Folga";
                        anaHours = "0";
                        classAna = 'folga';
                        daysOffAna.add(day);
                        anaDaysOffCount++;
                    }

                    if (!daysOffSibele.has(day) && Math.random() < 0.2 && sibeleDaysOffCount < 3) {
                        sibeleShift = "Folga";
                        sibeleHours = "0";
                        classSibele = 'folga';
                        daysOffSibele.add(day);
                        sibeleDaysOffCount++;
                    }

                    if (anaShift === "Folga") {
                        sibeleShift = shiftAnaWhenSibeleOff;
                        sibeleHours = calculateHours(13, 22);
                    }
                }

                schedule.push({
                    day,
                    dayOfWeek,
                    anaShift,
                    sibeleShift,
                    anaHours,
                    sibeleHours,
                    classAna,
                    classSibele
                });

                dayOfMonth++;
            }
            return schedule;
        }

        function calculateHours(startHour, endHour) {
            return (endHour - startHour - 1).toFixed(2);
        }

        function showMonth(month) {
            currentMonth = month;
            currentWeekStart = getFirstMondayOfMonth(currentMonth);
            updateSchedule();
        }

        function prevWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            updateSchedule();
        }

        function nextWeek() {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            updateSchedule();
        }

        function updateSchedule() {
            const anaScheduleBody = document.getElementById('anaScheduleBody');
            const sibeleScheduleBody = document.getElementById('sibeleScheduleBody');

            anaScheduleBody.innerHTML = '';
            sibeleScheduleBody.innerHTML = '';

            const schedule = generateSchedule(currentMonth, currentWeekStart);

            schedule.forEach(day => {
                let anaClass = day.classAna ? day.classAna : '';
                let sibeleClass = day.classSibele ? day.classSibele : '';

                anaScheduleBody.innerHTML += `
                    <tr class="${anaClass}">
                        <td>${day.day}</td>
                        <td>${day.dayOfWeek}</td>
                        <td>${day.anaShift}</td>
                        <td class="total">${day.anaHours} horas</td>
                        <td><textarea placeholder="Anotação" id="noteAna-${day.day}"></textarea></td>
                    </tr>
                `;

                sibeleScheduleBody.innerHTML += `
                    <tr class="${sibeleClass}">
                        <td>${day.day}</td>
                        <td>${day.dayOfWeek}</td>
                        <td>${day.sibeleShift}</td>
                        <td class="total">${day.sibeleHours} horas</td>
                        <td><textarea placeholder="Anotação" id="noteSibele-${day.day}"></textarea></td>
                    </tr>
                `;
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateSchedule();
        });
    </script>
</body>
</html>
